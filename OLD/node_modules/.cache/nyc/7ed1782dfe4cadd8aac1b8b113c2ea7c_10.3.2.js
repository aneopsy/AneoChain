var cov_1k4bc8by81=function(){var path='/home/aneopsy/AneoChain/src/blockchain/index.js',hash='6199cc6570f8c66781307c848e313753676b7751',global=new Function('return this')(),gcv='__coverage__',coverageData={path:'/home/aneopsy/AneoChain/src/blockchain/index.js',statementMap:{'0':{start:{line:1,column:21},end:{line:1,column:38}},'1':{start:{line:2,column:10},end:{line:2,column:26}},'2':{start:{line:3,column:11},end:{line:3,column:32}},'3':{start:{line:4,column:15},end:{line:4,column:34}},'4':{start:{line:5,column:14},end:{line:5,column:32}},'5':{start:{line:6,column:21},end:{line:6,column:46}},'6':{start:{line:7,column:34},end:{line:7,column:72}},'7':{start:{line:8,column:28},end:{line:8,column:60}},'8':{start:{line:9,column:33},end:{line:9,column:70}},'9':{start:{line:11,column:24},end:{line:11,column:37}},'10':{start:{line:12,column:26},end:{line:12,column:45}},'11':{start:{line:14,column:24},end:{line:14,column:47}},'12':{start:{line:15,column:23},end:{line:15,column:24}},'13':{start:{line:16,column:18},end:{line:16,column:19}},'14':{start:{line:18,column:22},end:{line:18,column:32}},'15':{start:{line:22,column:4},end:{line:22,column:83}},'16':{start:{line:23,column:4},end:{line:23,column:97}},'17':{start:{line:25,column:4},end:{line:25,column:45}},'18':{start:{line:26,column:4},end:{line:26,column:63}},'19':{start:{line:28,column:4},end:{line:28,column:38}},'20':{start:{line:29,column:4},end:{line:29,column:16}},'21':{start:{line:33,column:4},end:{line:37,column:5}},'22':{start:{line:34,column:6},end:{line:34,column:61}},'23':{start:{line:35,column:6},end:{line:35,column:38}},'24':{start:{line:36,column:6},end:{line:36,column:39}},'25':{start:{line:39,column:4},end:{line:39,column:69}},'26':{start:{line:40,column:4},end:{line:40,column:84}},'27':{start:{line:44,column:4},end:{line:44,column:23}},'28':{start:{line:48,column:4},end:{line:48,column:57}},'29':{start:{line:52,column:4},end:{line:52,column:55}},'30':{start:{line:56,column:4},end:{line:56,column:31}},'31':{start:{line:60,column:4},end:{line:64,column:12}},'32':{start:{line:68,column:4},end:{line:68,column:29}},'33':{start:{line:72,column:4},end:{line:72,column:57}},'34':{start:{line:76,column:4},end:{line:76,column:105}},'35':{start:{line:80,column:4},end:{line:83,column:5}},'36':{start:{line:81,column:6},end:{line:81,column:70}},'37':{start:{line:82,column:6},end:{line:82,column:91}},'38':{start:{line:85,column:4},end:{line:85,column:35}},'39':{start:{line:87,column:4},end:{line:87,column:104}},'40':{start:{line:88,column:20},end:{line:88,column:88}},'41':{start:{line:90,column:4},end:{line:92,column:18}},'42':{start:{line:91,column:6},end:{line:91,column:34}},'43':{start:{line:94,column:4},end:{line:94,column:55}},'44':{start:{line:98,column:4},end:{line:101,column:5}},'45':{start:{line:99,column:6},end:{line:99,column:55}},'46':{start:{line:100,column:6},end:{line:100,column:76}},'47':{start:{line:103,column:4},end:{line:110,column:5}},'48':{start:{line:104,column:6},end:{line:106,column:7}},'49':{start:{line:105,column:8},end:{line:105,column:78}},'50':{start:{line:108,column:6},end:{line:108,column:46}},'51':{start:{line:109,column:6},end:{line:109,column:77}},'52':{start:{line:111,column:4},end:{line:111,column:16}},'53':{start:{line:115,column:4},end:{line:126,column:5}},'54':{start:{line:116,column:6},end:{line:116,column:33}},'55':{start:{line:117,column:6},end:{line:117,column:39}},'56':{start:{line:119,column:6},end:{line:119,column:61}},'57':{start:{line:121,column:6},end:{line:121,column:52}},'58':{start:{line:122,column:6},end:{line:122,column:62}},'59':{start:{line:123,column:6},end:{line:123,column:58}},'60':{start:{line:123,column:16},end:{line:123,column:58}},'61':{start:{line:125,column:6},end:{line:125,column:22}},'62':{start:{line:130,column:4},end:{line:139,column:5}},'63':{start:{line:131,column:6},end:{line:131,column:45}},'64':{start:{line:132,column:6},end:{line:132,column:51}},'65':{start:{line:134,column:6},end:{line:134,column:62}},'66':{start:{line:135,column:6},end:{line:135,column:74}},'67':{start:{line:136,column:6},end:{line:136,column:70}},'68':{start:{line:136,column:16},end:{line:136,column:70}},'69':{start:{line:138,column:6},end:{line:138,column:28}},'70':{start:{line:143,column:4},end:{line:145,column:26}},'71':{start:{line:144,column:6},end:{line:144,column:75}},'72':{start:{line:146,column:4},end:{line:146,column:49}},'73':{start:{line:150,column:22},end:{line:150,column:39}},'74':{start:{line:152,column:4},end:{line:164,column:5}},'75':{start:{line:153,column:6},end:{line:153,column:100}},'76':{start:{line:154,column:6},end:{line:154,column:116}},'77':{start:{line:155,column:11},end:{line:164,column:5}},'78':{start:{line:156,column:6},end:{line:156,column:109}},'79':{start:{line:157,column:6},end:{line:157,column:125}},'80':{start:{line:158,column:11},end:{line:164,column:5}},'81':{start:{line:159,column:6},end:{line:159,column:84}},'82':{start:{line:160,column:6},end:{line:160,column:100}},'83':{start:{line:161,column:11},end:{line:164,column:5}},'84':{start:{line:162,column:6},end:{line:162,column:155}},'85':{start:{line:163,column:6},end:{line:163,column:154}},'86':{start:{line:166,column:4},end:{line:166,column:71}},'87':{start:{line:168,column:28},end:{line:168,column:160}},'88':{start:{line:169,column:29},end:{line:169,column:146}},'89':{start:{line:171,column:56},end:{line:171,column:100}},'90':{start:{line:173,column:4},end:{line:179,column:5}},'91':{start:{line:174,column:6},end:{line:174,column:117}},'92':{start:{line:175,column:6},end:{line:178,column:9}},'93':{start:{line:181,column:29},end:{line:181,column:77}},'94':{start:{line:182,column:4},end:{line:185,column:5}},'95':{start:{line:183,column:6},end:{line:183,column:99}},'96':{start:{line:184,column:6},end:{line:184,column:115}},'97':{start:{line:187,column:4},end:{line:190,column:5}},'98':{start:{line:188,column:6},end:{line:188,column:105}},'99':{start:{line:189,column:6},end:{line:189,column:121}},'100':{start:{line:192,column:4},end:{line:192,column:16}},'101':{start:{line:196,column:4},end:{line:196,column:35}},'102':{start:{line:198,column:28},end:{line:200,column:19}},'103':{start:{line:199,column:6},end:{line:199,column:72}},'104':{start:{line:202,column:4},end:{line:205,column:5}},'105':{start:{line:203,column:6},end:{line:203,column:84}},'106':{start:{line:204,column:6},end:{line:204,column:119}},'107':{start:{line:207,column:37},end:{line:219,column:33}},'108':{start:{line:208,column:6},end:{line:218,column:24}},'109':{start:{line:221,column:4},end:{line:224,column:5}},'110':{start:{line:222,column:6},end:{line:222,column:86}},'111':{start:{line:223,column:6},end:{line:223,column:133}},'112':{start:{line:226,column:4},end:{line:226,column:16}},'113':{start:{line:230,column:20},end:{line:230,column:22}},'114':{start:{line:231,column:4},end:{line:242,column:22}},'115':{start:{line:232,column:6},end:{line:241,column:35}},'116':{start:{line:233,column:8},end:{line:233,column:59}},'117':{start:{line:233,column:52},end:{line:233,column:59}},'118':{start:{line:235,column:8},end:{line:240,column:11}},'119':{start:{line:244,column:19},end:{line:244,column:21}},'120':{start:{line:245,column:4},end:{line:256,column:21}},'121':{start:{line:247,column:8},end:{line:247,column:58}},'122':{start:{line:247,column:51},end:{line:247,column:58}},'123':{start:{line:249,column:8},end:{line:254,column:11}},'124':{start:{line:258,column:35},end:{line:258,column:37}},'125':{start:{line:259,column:4},end:{line:263,column:18}},'126':{start:{line:260,column:6},end:{line:262,column:7}},'127':{start:{line:260,column:30},end:{line:260,column:108}},'128':{start:{line:261,column:8},end:{line:261,column:48}},'129':{start:{line:265,column:4},end:{line:265,column:36}},'130':{start:{line:269,column:0},end:{line:269,column:28}}},fnMap:{'0':{name:'(anonymous_0)',decl:{start:{line:21,column:2},end:{line:21,column:3}},loc:{start:{line:21,column:22},end:{line:30,column:3}},line:21},'1':{name:'(anonymous_1)',decl:{start:{line:32,column:2},end:{line:32,column:3}},loc:{start:{line:32,column:9},end:{line:41,column:3}},line:32},'2':{name:'(anonymous_2)',decl:{start:{line:43,column:2},end:{line:43,column:3}},loc:{start:{line:43,column:17},end:{line:45,column:3}},line:43},'3':{name:'(anonymous_3)',decl:{start:{line:47,column:2},end:{line:47,column:3}},loc:{start:{line:47,column:25},end:{line:49,column:3}},line:47},'4':{name:'(anonymous_4)',decl:{start:{line:51,column:2},end:{line:51,column:3}},loc:{start:{line:51,column:23},end:{line:53,column:3}},line:51},'5':{name:'(anonymous_5)',decl:{start:{line:55,column:2},end:{line:55,column:3}},loc:{start:{line:55,column:17},end:{line:57,column:3}},line:55},'6':{name:'(anonymous_6)',decl:{start:{line:59,column:2},end:{line:59,column:3}},loc:{start:{line:59,column:23},end:{line:65,column:3}},line:59},'7':{name:'(anonymous_7)',decl:{start:{line:67,column:2},end:{line:67,column:3}},loc:{start:{line:67,column:23},end:{line:69,column:3}},line:67},'8':{name:'(anonymous_8)',decl:{start:{line:71,column:2},end:{line:71,column:3}},loc:{start:{line:71,column:25},end:{line:73,column:3}},line:71},'9':{name:'(anonymous_9)',decl:{start:{line:75,column:2},end:{line:75,column:3}},loc:{start:{line:75,column:42},end:{line:77,column:3}},line:75},'10':{name:'(anonymous_10)',decl:{start:{line:79,column:2},end:{line:79,column:3}},loc:{start:{line:79,column:30},end:{line:95,column:3}},line:79},'11':{name:'(anonymous_11)',decl:{start:{line:90,column:14},end:{line:90,column:15}},loc:{start:{line:90,column:25},end:{line:92,column:5}},line:90},'12':{name:'(anonymous_12)',decl:{start:{line:97,column:2},end:{line:97,column:3}},loc:{start:{line:97,column:35},end:{line:112,column:3}},line:97},'13':{name:'(anonymous_13)',decl:{start:{line:114,column:2},end:{line:114,column:3}},loc:{start:{line:114,column:34},end:{line:127,column:3}},line:114},'14':{name:'(anonymous_14)',decl:{start:{line:129,column:2},end:{line:129,column:3}},loc:{start:{line:129,column:46},end:{line:140,column:3}},line:129},'15':{name:'(anonymous_15)',decl:{start:{line:142,column:2},end:{line:142,column:3}},loc:{start:{line:142,column:52},end:{line:147,column:3}},line:142},'16':{name:'(anonymous_16)',decl:{start:{line:143,column:33},end:{line:143,column:34}},loc:{start:{line:143,column:50},end:{line:145,column:5}},line:143},'17':{name:'(anonymous_17)',decl:{start:{line:149,column:2},end:{line:149,column:3}},loc:{start:{line:149,column:38},end:{line:193,column:3}},line:149},'18':{name:'(anonymous_18)',decl:{start:{line:195,column:2},end:{line:195,column:3}},loc:{start:{line:195,column:32},end:{line:227,column:3}},line:195},'19':{name:'(anonymous_19)',decl:{start:{line:198,column:34},end:{line:198,column:35}},loc:{start:{line:198,column:45},end:{line:200,column:5}},line:198},'20':{name:'(anonymous_20)',decl:{start:{line:207,column:76},end:{line:207,column:77}},loc:{start:{line:207,column:89},end:{line:219,column:5}},line:207},'21':{name:'(anonymous_21)',decl:{start:{line:229,column:2},end:{line:229,column:3}},loc:{start:{line:229,column:44},end:{line:266,column:3}},line:229},'22':{name:'(anonymous_22)',decl:{start:{line:231,column:55},end:{line:231,column:56}},loc:{start:{line:231,column:72},end:{line:242,column:5}},line:231},'23':{name:'(anonymous_23)',decl:{start:{line:232,column:26},end:{line:232,column:27}},loc:{start:{line:232,column:47},end:{line:241,column:7}},line:232},'24':{name:'(anonymous_24)',decl:{start:{line:246,column:51},end:{line:246,column:52}},loc:{start:{line:246,column:64},end:{line:255,column:7}},line:246},'25':{name:'(anonymous_25)',decl:{start:{line:259,column:14},end:{line:259,column:15}},loc:{start:{line:259,column:28},end:{line:263,column:5}},line:259},'26':{name:'(anonymous_26)',decl:{start:{line:260,column:17},end:{line:260,column:18}},loc:{start:{line:260,column:30},end:{line:260,column:108}},line:260}},branchMap:{'0':{loc:{start:{line:33,column:4},end:{line:37,column:5}},type:'if',locations:[{start:{line:33,column:4},end:{line:37,column:5}},{start:{line:33,column:4},end:{line:37,column:5}}],line:33},'1':{loc:{start:{line:63,column:23},end:{line:63,column:50}},type:'binary-expr',locations:[{start:{line:63,column:23},end:{line:63,column:28}},{start:{line:63,column:32},end:{line:63,column:50}}],line:63},'2':{loc:{start:{line:80,column:4},end:{line:83,column:5}},type:'if',locations:[{start:{line:80,column:4},end:{line:83,column:5}},{start:{line:80,column:4},end:{line:83,column:5}}],line:80},'3':{loc:{start:{line:98,column:4},end:{line:101,column:5}},type:'if',locations:[{start:{line:98,column:4},end:{line:101,column:5}},{start:{line:98,column:4},end:{line:101,column:5}}],line:98},'4':{loc:{start:{line:114,column:21},end:{line:114,column:32}},type:'default-arg',locations:[{start:{line:114,column:28},end:{line:114,column:32}}],line:114},'5':{loc:{start:{line:115,column:4},end:{line:126,column:5}},type:'if',locations:[{start:{line:115,column:4},end:{line:126,column:5}},{start:{line:115,column:4},end:{line:126,column:5}}],line:115},'6':{loc:{start:{line:123,column:6},end:{line:123,column:58}},type:'if',locations:[{start:{line:123,column:6},end:{line:123,column:58}},{start:{line:123,column:6},end:{line:123,column:58}}],line:123},'7':{loc:{start:{line:129,column:33},end:{line:129,column:44}},type:'default-arg',locations:[{start:{line:129,column:40},end:{line:129,column:44}}],line:129},'8':{loc:{start:{line:130,column:4},end:{line:139,column:5}},type:'if',locations:[{start:{line:130,column:4},end:{line:139,column:5}},{start:{line:130,column:4},end:{line:139,column:5}}],line:130},'9':{loc:{start:{line:136,column:6},end:{line:136,column:70}},type:'if',locations:[{start:{line:136,column:6},end:{line:136,column:70}},{start:{line:136,column:6},end:{line:136,column:70}}],line:136},'10':{loc:{start:{line:152,column:4},end:{line:164,column:5}},type:'if',locations:[{start:{line:152,column:4},end:{line:164,column:5}},{start:{line:152,column:4},end:{line:164,column:5}}],line:152},'11':{loc:{start:{line:155,column:11},end:{line:164,column:5}},type:'if',locations:[{start:{line:155,column:11},end:{line:164,column:5}},{start:{line:155,column:11},end:{line:164,column:5}}],line:155},'12':{loc:{start:{line:158,column:11},end:{line:164,column:5}},type:'if',locations:[{start:{line:158,column:11},end:{line:164,column:5}},{start:{line:158,column:11},end:{line:164,column:5}}],line:158},'13':{loc:{start:{line:161,column:11},end:{line:164,column:5}},type:'if',locations:[{start:{line:161,column:11},end:{line:164,column:5}},{start:{line:161,column:11},end:{line:164,column:5}}],line:161},'14':{loc:{start:{line:173,column:4},end:{line:179,column:5}},type:'if',locations:[{start:{line:173,column:4},end:{line:179,column:5}},{start:{line:173,column:4},end:{line:179,column:5}}],line:173},'15':{loc:{start:{line:182,column:4},end:{line:185,column:5}},type:'if',locations:[{start:{line:182,column:4},end:{line:185,column:5}},{start:{line:182,column:4},end:{line:185,column:5}}],line:182},'16':{loc:{start:{line:182,column:8},end:{line:182,column:60}},type:'binary-expr',locations:[{start:{line:182,column:8},end:{line:182,column:30}},{start:{line:182,column:34},end:{line:182,column:60}}],line:182},'17':{loc:{start:{line:187,column:4},end:{line:190,column:5}},type:'if',locations:[{start:{line:187,column:4},end:{line:190,column:5}},{start:{line:187,column:4},end:{line:190,column:5}}],line:187},'18':{loc:{start:{line:187,column:8},end:{line:187,column:66}},type:'binary-expr',locations:[{start:{line:187,column:8},end:{line:187,column:33}},{start:{line:187,column:37},end:{line:187,column:66}}],line:187},'19':{loc:{start:{line:202,column:4},end:{line:205,column:5}},type:'if',locations:[{start:{line:202,column:4},end:{line:205,column:5}},{start:{line:202,column:4},end:{line:205,column:5}}],line:202},'20':{loc:{start:{line:221,column:4},end:{line:224,column:5}},type:'if',locations:[{start:{line:221,column:4},end:{line:224,column:5}},{start:{line:221,column:4},end:{line:224,column:5}}],line:221},'21':{loc:{start:{line:233,column:8},end:{line:233,column:59}},type:'if',locations:[{start:{line:233,column:8},end:{line:233,column:59}},{start:{line:233,column:8},end:{line:233,column:59}}],line:233},'22':{loc:{start:{line:233,column:12},end:{line:233,column:50}},type:'binary-expr',locations:[{start:{line:233,column:12},end:{line:233,column:19}},{start:{line:233,column:23},end:{line:233,column:50}}],line:233},'23':{loc:{start:{line:247,column:8},end:{line:247,column:58}},type:'if',locations:[{start:{line:247,column:8},end:{line:247,column:58}},{start:{line:247,column:8},end:{line:247,column:58}}],line:247},'24':{loc:{start:{line:247,column:12},end:{line:247,column:49}},type:'binary-expr',locations:[{start:{line:247,column:12},end:{line:247,column:19}},{start:{line:247,column:23},end:{line:247,column:49}}],line:247},'25':{loc:{start:{line:260,column:6},end:{line:262,column:7}},type:'if',locations:[{start:{line:260,column:6},end:{line:262,column:7}},{start:{line:260,column:6},end:{line:262,column:7}}],line:260},'26':{loc:{start:{line:260,column:30},end:{line:260,column:108}},type:'binary-expr',locations:[{start:{line:260,column:30},end:{line:260,column:73}},{start:{line:260,column:77},end:{line:260,column:108}}],line:260}},s:{'0':0,'1':0,'2':0,'3':0,'4':0,'5':0,'6':0,'7':0,'8':0,'9':0,'10':0,'11':0,'12':0,'13':0,'14':0,'15':0,'16':0,'17':0,'18':0,'19':0,'20':0,'21':0,'22':0,'23':0,'24':0,'25':0,'26':0,'27':0,'28':0,'29':0,'30':0,'31':0,'32':0,'33':0,'34':0,'35':0,'36':0,'37':0,'38':0,'39':0,'40':0,'41':0,'42':0,'43':0,'44':0,'45':0,'46':0,'47':0,'48':0,'49':0,'50':0,'51':0,'52':0,'53':0,'54':0,'55':0,'56':0,'57':0,'58':0,'59':0,'60':0,'61':0,'62':0,'63':0,'64':0,'65':0,'66':0,'67':0,'68':0,'69':0,'70':0,'71':0,'72':0,'73':0,'74':0,'75':0,'76':0,'77':0,'78':0,'79':0,'80':0,'81':0,'82':0,'83':0,'84':0,'85':0,'86':0,'87':0,'88':0,'89':0,'90':0,'91':0,'92':0,'93':0,'94':0,'95':0,'96':0,'97':0,'98':0,'99':0,'100':0,'101':0,'102':0,'103':0,'104':0,'105':0,'106':0,'107':0,'108':0,'109':0,'110':0,'111':0,'112':0,'113':0,'114':0,'115':0,'116':0,'117':0,'118':0,'119':0,'120':0,'121':0,'122':0,'123':0,'124':0,'125':0,'126':0,'127':0,'128':0,'129':0,'130':0},f:{'0':0,'1':0,'2':0,'3':0,'4':0,'5':0,'6':0,'7':0,'8':0,'9':0,'10':0,'11':0,'12':0,'13':0,'14':0,'15':0,'16':0,'17':0,'18':0,'19':0,'20':0,'21':0,'22':0,'23':0,'24':0,'25':0,'26':0},b:{'0':[0,0],'1':[0,0],'2':[0,0],'3':[0,0],'4':[0],'5':[0,0],'6':[0,0],'7':[0],'8':[0,0],'9':[0,0],'10':[0,0],'11':[0,0],'12':[0,0],'13':[0,0],'14':[0,0],'15':[0,0],'16':[0,0],'17':[0,0],'18':[0,0],'19':[0,0],'20':[0,0],'21':[0,0],'22':[0,0],'23':[0,0],'24':[0,0],'25':[0,0],'26':[0,0]},_coverageSchema:'332fd63041d2c1bcb487cc26dd0d5f7d97098a6c'},coverage=global[gcv]||(global[gcv]={});if(coverage[path]&&coverage[path].hash===hash){return coverage[path];}coverageData.hash=hash;return coverage[path]=coverageData;}();const EventEmitter=(++cov_1k4bc8by81.s[0],require('events'));const R=(++cov_1k4bc8by81.s[1],require('ramda'));const Db=(++cov_1k4bc8by81.s[2],require('../util/db'));const Blocks=(++cov_1k4bc8by81.s[3],require('./blocks'));const Block=(++cov_1k4bc8by81.s[4],require('./block'));const Transactions=(++cov_1k4bc8by81.s[5],require('./transactions'));const TransactionAssertionError=(++cov_1k4bc8by81.s[6],require('./transactionAssertionError'));const BlockAssertionError=(++cov_1k4bc8by81.s[7],require('./blockAssertionError'));const BlockchainAssertionError=(++cov_1k4bc8by81.s[8],require('./blockchainAssertionError'));const BLOCKCHAIN_FILE=(++cov_1k4bc8by81.s[9],'blocks.json');const TRANSACTIONS_FILE=(++cov_1k4bc8by81.s[10],'transactions.json');const BASE_DIFFICULTY=(++cov_1k4bc8by81.s[11],Number.MAX_SAFE_INTEGER);const EVERY_X_BLOCKS=(++cov_1k4bc8by81.s[12],5);const POW_CURVE=(++cov_1k4bc8by81.s[13],5);const MINING_REWARD=(++cov_1k4bc8by81.s[14],5000000000);class Blockchain{constructor(dbName){++cov_1k4bc8by81.f[0];++cov_1k4bc8by81.s[15];this.blocksDb=new Db('data/'+dbName+'/'+BLOCKCHAIN_FILE,new Blocks());++cov_1k4bc8by81.s[16];this.transactionsDb=new Db('data/'+dbName+'/'+TRANSACTIONS_FILE,new Transactions());++cov_1k4bc8by81.s[17];this.blocks=this.blocksDb.read(Blocks);++cov_1k4bc8by81.s[18];this.transactions=this.transactionsDb.read(Transactions);++cov_1k4bc8by81.s[19];this.emitter=new EventEmitter();++cov_1k4bc8by81.s[20];this.init();}init(){++cov_1k4bc8by81.f[1];++cov_1k4bc8by81.s[21];if(this.blocks.length==0){++cov_1k4bc8by81.b[0][0];++cov_1k4bc8by81.s[22];console.info('Blockchain empty, adding genesis block');++cov_1k4bc8by81.s[23];this.blocks.push(Block.genesis);++cov_1k4bc8by81.s[24];this.blocksDb.write(this.blocks);}else{++cov_1k4bc8by81.b[0][1];}++cov_1k4bc8by81.s[25];console.info('Removing transactions that are in the blockchain');++cov_1k4bc8by81.s[26];R.forEach(this.removeBlockTransactionsFromTransactions.bind(this),this.blocks);}getAllBlocks(){++cov_1k4bc8by81.f[2];++cov_1k4bc8by81.s[27];return this.blocks;}getBlockByIndex(index){++cov_1k4bc8by81.f[3];++cov_1k4bc8by81.s[28];return R.find(R.propEq('index',index),this.blocks);}getBlockByHash(hash){++cov_1k4bc8by81.f[4];++cov_1k4bc8by81.s[29];return R.find(R.propEq('hash',hash),this.blocks);}getLastBlock(){++cov_1k4bc8by81.f[5];++cov_1k4bc8by81.s[30];return R.last(this.blocks);}getDifficulty(index){++cov_1k4bc8by81.f[6];++cov_1k4bc8by81.s[31];return Math.max(Math.floor(BASE_DIFFICULTY/Math.pow(Math.floor((((++cov_1k4bc8by81.b[1][0],index)||(++cov_1k4bc8by81.b[1][1],this.blocks.length))+1)/EVERY_X_BLOCKS)+1,POW_CURVE)),0);}getAllTransactions(){++cov_1k4bc8by81.f[7];++cov_1k4bc8by81.s[32];return this.transactions;}getTransactionById(id){++cov_1k4bc8by81.f[8];++cov_1k4bc8by81.s[33];return R.find(R.propEq('id',id),this.transactions);}getTransactionFromBlocks(transactionId){++cov_1k4bc8by81.f[9];++cov_1k4bc8by81.s[34];return R.find(R.compose(R.find(R.propEq('id',transactionId)),R.prop('transactions')),this.blocks);}replaceChain(newBlockchain){++cov_1k4bc8by81.f[10];++cov_1k4bc8by81.s[35];if(newBlockchain.length<=this.blocks.length){++cov_1k4bc8by81.b[2][0];++cov_1k4bc8by81.s[36];console.error('Blockchain shorter than the current blockchain');++cov_1k4bc8by81.s[37];throw new BlockchainAssertionError('Blockchain shorter than the current blockchain');}else{++cov_1k4bc8by81.b[2][1];}++cov_1k4bc8by81.s[38];this.checkChain(newBlockchain);++cov_1k4bc8by81.s[39];console.info('Received blockchain is valid. Replacing current blockchain with received blockchain');let newBlocks=(++cov_1k4bc8by81.s[40],R.takeLast(newBlockchain.length-this.blocks.length,newBlockchain));++cov_1k4bc8by81.s[41];R.forEach(block=>{++cov_1k4bc8by81.f[11];++cov_1k4bc8by81.s[42];this.addBlock(block,false);},newBlocks);++cov_1k4bc8by81.s[43];this.emitter.emit('blockchainReplaced',newBlocks);}checkChain(blockchainToValidate){++cov_1k4bc8by81.f[12];++cov_1k4bc8by81.s[44];if(JSON.stringify(blockchainToValidate[0])!==JSON.stringify(Block.genesis)){++cov_1k4bc8by81.b[3][0];++cov_1k4bc8by81.s[45];console.error('Genesis blocks aren\'t the same');++cov_1k4bc8by81.s[46];throw new BlockchainAssertionError('Genesis blocks aren\'t the same');}else{++cov_1k4bc8by81.b[3][1];}++cov_1k4bc8by81.s[47];try{++cov_1k4bc8by81.s[48];for(let i=1;i<blockchainToValidate.length;i++){++cov_1k4bc8by81.s[49];this.checkBlock(blockchainToValidate[i],blockchainToValidate[i-1]);}}catch(ex){++cov_1k4bc8by81.s[50];console.error('Invalid block sequence');++cov_1k4bc8by81.s[51];throw new BlockchainAssertionError('Invalid block sequence',null,ex);}++cov_1k4bc8by81.s[52];return true;}addBlock(newBlock,emit=(++cov_1k4bc8by81.b[4][0],true)){++cov_1k4bc8by81.f[13];++cov_1k4bc8by81.s[53];if(this.checkBlock(newBlock,this.getLastBlock())){++cov_1k4bc8by81.b[5][0];++cov_1k4bc8by81.s[54];this.blocks.push(newBlock);++cov_1k4bc8by81.s[55];this.blocksDb.write(this.blocks);++cov_1k4bc8by81.s[56];this.removeBlockTransactionsFromTransactions(newBlock);++cov_1k4bc8by81.s[57];console.info(`Block added: ${newBlock.hash}`);++cov_1k4bc8by81.s[58];console.log(`Block added: ${JSON.stringify(newBlock)}`);++cov_1k4bc8by81.s[59];if(emit){++cov_1k4bc8by81.b[6][0];++cov_1k4bc8by81.s[60];this.emitter.emit('blockAdded',newBlock);}else{++cov_1k4bc8by81.b[6][1];}++cov_1k4bc8by81.s[61];return newBlock;}else{++cov_1k4bc8by81.b[5][1];}}addTransaction(newTransaction,emit=(++cov_1k4bc8by81.b[7][0],true)){++cov_1k4bc8by81.f[14];++cov_1k4bc8by81.s[62];if(this.checkTransaction(newTransaction)){++cov_1k4bc8by81.b[8][0];++cov_1k4bc8by81.s[63];this.transactions.push(newTransaction);++cov_1k4bc8by81.s[64];this.transactionsDb.write(this.transactions);++cov_1k4bc8by81.s[65];console.info(`Transaction added: ${newTransaction.id}`);++cov_1k4bc8by81.s[66];console.log(`Transaction added: ${JSON.stringify(newTransaction)}`);++cov_1k4bc8by81.s[67];if(emit){++cov_1k4bc8by81.b[9][0];++cov_1k4bc8by81.s[68];this.emitter.emit('transactionAdded',newTransaction);}else{++cov_1k4bc8by81.b[9][1];}++cov_1k4bc8by81.s[69];return newTransaction;}else{++cov_1k4bc8by81.b[8][1];}}removeBlockTransactionsFromTransactions(newBlock){++cov_1k4bc8by81.f[15];++cov_1k4bc8by81.s[70];this.transactions=R.reject(transaction=>{++cov_1k4bc8by81.f[16];++cov_1k4bc8by81.s[71];return R.find(R.propEq('id',transaction.id),newBlock.transactions);},this.transactions);++cov_1k4bc8by81.s[72];this.transactionsDb.write(this.transactions);}checkBlock(newBlock,previousBlock){++cov_1k4bc8by81.f[17];const blockHash=(++cov_1k4bc8by81.s[73],newBlock.toHash());++cov_1k4bc8by81.s[74];if(previousBlock.index+1!==newBlock.index){++cov_1k4bc8by81.b[10][0];++cov_1k4bc8by81.s[75];console.error(`Invalid index: expected '${previousBlock.index+1}' got '${newBlock.index}'`);++cov_1k4bc8by81.s[76];throw new BlockAssertionError(`Invalid index: expected '${previousBlock.index+1}' got '${newBlock.index}'`);}else{++cov_1k4bc8by81.b[10][1];++cov_1k4bc8by81.s[77];if(previousBlock.hash!==newBlock.previousHash){++cov_1k4bc8by81.b[11][0];++cov_1k4bc8by81.s[78];console.error(`Invalid previoushash: expected '${previousBlock.hash}' got '${newBlock.previousHash}'`);++cov_1k4bc8by81.s[79];throw new BlockAssertionError(`Invalid previoushash: expected '${previousBlock.hash}' got '${newBlock.previousHash}'`);}else{++cov_1k4bc8by81.b[11][1];++cov_1k4bc8by81.s[80];if(blockHash!==newBlock.hash){++cov_1k4bc8by81.b[12][0];++cov_1k4bc8by81.s[81];console.error(`Invalid hash: expected '${blockHash}' got '${newBlock.hash}'`);++cov_1k4bc8by81.s[82];throw new BlockAssertionError(`Invalid hash: expected '${blockHash}' got '${newBlock.hash}'`);}else{++cov_1k4bc8by81.b[12][1];++cov_1k4bc8by81.s[83];if(newBlock.getDifficulty()>=this.getDifficulty(newBlock.index)){++cov_1k4bc8by81.b[13][0];++cov_1k4bc8by81.s[84];console.error(`Invalid proof-of-work difficulty: expected '${newBlock.getDifficulty()}' to be smaller than '${this.getDifficulty(newBlock.index)}'`);++cov_1k4bc8by81.s[85];throw new BlockAssertionError(`Invalid proof-of-work difficulty: expected '${newBlock.getDifficulty()}' be smaller than '${this.getDifficulty()}'`);}else{++cov_1k4bc8by81.b[13][1];}}}}++cov_1k4bc8by81.s[86];R.forEach(this.checkTransaction.bind(this),newBlock.transactions);let sumOfInputsAmount=(++cov_1k4bc8by81.s[87],R.sum(R.flatten(R.map(R.compose(R.map(R.prop('amount')),R.prop('inputs'),R.prop('data')),newBlock.transactions)))+MINING_REWARD);let sumOfOutputsAmount=(++cov_1k4bc8by81.s[88],R.sum(R.flatten(R.map(R.compose(R.map(R.prop('amount')),R.prop('outputs'),R.prop('data')),newBlock.transactions))));let isInputsAmountGreaterOrEqualThanOutputsAmount=(++cov_1k4bc8by81.s[89],R.gte(sumOfInputsAmount,sumOfOutputsAmount));++cov_1k4bc8by81.s[90];if(!isInputsAmountGreaterOrEqualThanOutputsAmount){++cov_1k4bc8by81.b[14][0];++cov_1k4bc8by81.s[91];console.error(`Invalid block balance: inputs sum '${sumOfInputsAmount}', outputs sum '${sumOfOutputsAmount}'`);++cov_1k4bc8by81.s[92];throw new BlockAssertionError(`Invalid block balance: inputs sum '${sumOfInputsAmount}', outputs sum '${sumOfOutputsAmount}'`,{sumOfInputsAmount,sumOfOutputsAmount});}else{++cov_1k4bc8by81.b[14][1];}let transactionsByType=(++cov_1k4bc8by81.s[93],R.countBy(R.prop('type'),newBlock.transactions));++cov_1k4bc8by81.s[94];if((++cov_1k4bc8by81.b[16][0],transactionsByType.fee)&&(++cov_1k4bc8by81.b[16][1],transactionsByType.fee>1)){++cov_1k4bc8by81.b[15][0];++cov_1k4bc8by81.s[95];console.error(`Invalid fee transaction count: expected '1' got '${transactionsByType.fee}'`);++cov_1k4bc8by81.s[96];throw new BlockAssertionError(`Invalid fee transaction count: expected '1' got '${transactionsByType.fee}'`);}else{++cov_1k4bc8by81.b[15][1];}++cov_1k4bc8by81.s[97];if((++cov_1k4bc8by81.b[18][0],transactionsByType.reward)&&(++cov_1k4bc8by81.b[18][1],transactionsByType.reward>1)){++cov_1k4bc8by81.b[17][0];++cov_1k4bc8by81.s[98];console.error(`Invalid reward transaction count: expected '1' got '${transactionsByType.reward}'`);++cov_1k4bc8by81.s[99];throw new BlockAssertionError(`Invalid reward transaction count: expected '1' got '${transactionsByType.reward}'`);}else{++cov_1k4bc8by81.b[17][1];}++cov_1k4bc8by81.s[100];return true;}checkTransaction(transaction){++cov_1k4bc8by81.f[18];++cov_1k4bc8by81.s[101];transaction.check(transaction);let isNotInBlockchain=(++cov_1k4bc8by81.s[102],R.all(block=>{++cov_1k4bc8by81.f[19];++cov_1k4bc8by81.s[103];return R.none(R.propEq('id',transaction.id),block.transactions);},this.blocks));++cov_1k4bc8by81.s[104];if(!isNotInBlockchain){++cov_1k4bc8by81.b[19][0];++cov_1k4bc8by81.s[105];console.error(`Transaction '${transaction.id}' is already in the blockchain`);++cov_1k4bc8by81.s[106];throw new TransactionAssertionError(`Transaction '${transaction.id}' is already in the blockchain`,transaction);}else{++cov_1k4bc8by81.b[19][1];}let isInputTransactionsUnspent=(++cov_1k4bc8by81.s[107],R.all(R.equals(false),R.flatten(R.map(txInput=>{++cov_1k4bc8by81.f[20];++cov_1k4bc8by81.s[108];return R.map(R.pipe(R.prop('transactions'),R.map(R.pipe(R.path(['data','inputs']),R.contains({transaction:txInput.transaction,index:txInput.index})))),this.blocks);},transaction.data.inputs))));++cov_1k4bc8by81.s[109];if(!isInputTransactionsUnspent){++cov_1k4bc8by81.b[20][0];++cov_1k4bc8by81.s[110];console.error(`Not all inputs are unspent for transaction '${transaction.id}'`);++cov_1k4bc8by81.s[111];throw new TransactionAssertionError(`Not all inputs are unspent for transaction '${transaction.id}'`,transaction.data.inputs);}else{++cov_1k4bc8by81.b[20][1];}++cov_1k4bc8by81.s[112];return true;}getUnspentTransactionsForAddress(address){++cov_1k4bc8by81.f[21];let txOutputs=(++cov_1k4bc8by81.s[113],[]);++cov_1k4bc8by81.s[114];R.forEach(R.pipe(R.prop('transactions'),R.forEach(transaction=>{++cov_1k4bc8by81.f[22];++cov_1k4bc8by81.s[115];R.forEachObjIndexed((txOutput,index)=>{++cov_1k4bc8by81.f[23];++cov_1k4bc8by81.s[116];if((++cov_1k4bc8by81.b[22][0],address)&&(++cov_1k4bc8by81.b[22][1],txOutput.address!=address)){++cov_1k4bc8by81.b[21][0];++cov_1k4bc8by81.s[117];return;}else{++cov_1k4bc8by81.b[21][1];}++cov_1k4bc8by81.s[118];txOutputs.push({transaction:transaction.id,index:index,amount:txOutput.amount,address:txOutput.address});},transaction.data.outputs);})),this.blocks);let txInputs=(++cov_1k4bc8by81.s[119],[]);++cov_1k4bc8by81.s[120];R.forEach(R.pipe(R.prop('transactions'),R.forEach(R.pipe(R.path(['data','inputs']),R.forEach(txInput=>{++cov_1k4bc8by81.f[24];++cov_1k4bc8by81.s[121];if((++cov_1k4bc8by81.b[24][0],address)&&(++cov_1k4bc8by81.b[24][1],txInput.address!=address)){++cov_1k4bc8by81.b[23][0];++cov_1k4bc8by81.s[122];return;}else{++cov_1k4bc8by81.b[23][1];}++cov_1k4bc8by81.s[123];txInputs.push({transaction:txInput.transaction,index:txInput.index,amount:txInput.amount,address:txInput.address});})))),this.blocks);let unspentTransactionOutput=(++cov_1k4bc8by81.s[124],[]);++cov_1k4bc8by81.s[125];R.forEach(txOutput=>{++cov_1k4bc8by81.f[25];++cov_1k4bc8by81.s[126];if(!R.any(txInput=>{++cov_1k4bc8by81.f[26];++cov_1k4bc8by81.s[127];return(++cov_1k4bc8by81.b[26][0],txInput.transaction==txOutput.transaction)&&(++cov_1k4bc8by81.b[26][1],txInput.index==txOutput.index);},txInputs)){++cov_1k4bc8by81.b[25][0];++cov_1k4bc8by81.s[128];unspentTransactionOutput.push(txOutput);}else{++cov_1k4bc8by81.b[25][1];}},txOutputs);++cov_1k4bc8by81.s[129];return unspentTransactionOutput;}}++cov_1k4bc8by81.s[130];module.exports=Blockchain;